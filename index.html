<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmartCard Connect - DuoBuddy</title>
  <style>
    body { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    .gradient-bg { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #06b6d4 100%); }
    .card { background: white; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.1); transition: transform .3s, box-shadow .3s; }
    .card:hover { transform: translateY(-5px); box-shadow: 0 15px 40px rgba(0,0,0,.15); }
    .btn { padding: 12px 32px; border-radius: 30px; font-weight: 600; cursor: pointer; transition: all .3s; border: none; font-size: 16px; display: inline-block; }
    .btn-primary { background: linear-gradient(135deg,#1e3a8a 0%,#3b82f6 100%); color: #fff; box-shadow: 0 4px 15px rgba(59,130,246,.4); }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(59,130,246,.6); }
    .btn-secondary { background: #fff; color: #1e3a8a; border: 2px solid #1e3a8a; }
    .btn-secondary:hover { background: #1e3a8a; color: #fff; }
    .btn-danger { background: #ef4444; color: #fff; }
    .btn-danger:hover { background: #dc2626; }
    .input-field { width: 100%; padding: 14px 20px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; transition: all .3s; }
    .input-field:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 4px rgba(59,130,246,.1); }
    .input-field.success { border-color: #10b981; }
    .input-field.error { border-color: #ef4444; }
    .nav-link { color: #fff; text-decoration: none; padding: 10px 20px; border-radius: 25px; transition: all .3s; font-weight: 500; }
    .nav-link:hover { background: rgba(255,255,255,.2); transform: translateY(-2px); }
    .page { display: none; min-height: 100%; }
    .page.active { display: block; }
    .toast { position: fixed; top: 20px; right: 20px; background: #fff; padding: 20px 30px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,.2); z-index: 99999; animation: slideIn .4s cubic-bezier(0.68,-0.55,0.265,1.55); }
    @keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    .profile-avatar { width: 150px; height: 150px; border-radius: 50%; background: linear-gradient(135deg,#1e3a8a 0%,#3b82f6 100%); display: flex; align-items: center; justify-content: center; color: #fff; font-size: 60px; font-weight: bold; margin: 0 auto 24px; box-shadow: 0 10px 30px rgba(59,130,246,.3); }
    .feature-card { text-align: center; padding: 40px 30px; border-radius: 16px; background: #fff; transition: all .3s; }
    .feature-card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,.15); }
    .feature-icon { font-size: 60px; margin-bottom: 20px; display: inline-block; animation: float 3s ease-in-out infinite; }
    @keyframes float { 0%,100%{ transform: translateY(0);} 50%{ transform: translateY(-10px);} }
    .card-slot { border: 3px dashed #d1d5db; border-radius: 16px; padding: 30px; text-align: center; cursor: pointer; transition: all .3s; position: relative; background: #fafafa; min-height: 280px; display: flex; flex-direction: column; justify-content: center; }
    .card-slot.active { border-color: #10b981; background: linear-gradient(135deg,#d1fae5 0%,#a7f3d0 100%); border-style: solid; }
    .card-slot:hover:not(.locked) { border-color: #3b82f6; transform: translateY(-8px); box-shadow: 0 15px 35px rgba(59,130,246,.2); background: #fff; }
    .status-badge { padding: 8px 20px; border-radius: 25px; font-size: 14px; font-weight: 700; display: inline-block; text-transform: uppercase; letter-spacing: .5px; }
    .status-trial { background: linear-gradient(135deg,#3b82f6 0%,#2563eb 100%); color: #fff; }
    .status-active { background: linear-gradient(135deg,#10b981 0%,#059669 100%); color: #fff; }
    .status-expired { background: linear-gradient(135deg,#ef4444 0%,#dc2626 100%); color: #fff; }
    .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f4f6; border-top-color: #667eea; border-radius: 50%; animation: spin .8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .table { width: 100%; border-collapse: collapse; }
    .table th,.table td { padding: 16px; text-align: left; border-bottom: 1px solid #e5e7eb; }
    .table th { background: linear-gradient(135deg,#f9fafb 0%,#f3f4f6 100%); font-weight: 700; color: #374151; text-transform: uppercase; font-size: 12px; letter-spacing: 1px; }
    .table tbody tr:hover { background: #f9fafb; }
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,.7); display: flex; align-items: center; justify-content: center; z-index: 9999; padding: 20px; overflow-y: auto; }
    .modal-content { background: #fff; border-radius: 24px; max-width: 800px; width: 100%; max-height: 90%; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,.3); animation: modalSlideIn .3s ease-out; }
    @keyframes modalSlideIn { from { opacity: 0; transform: translateY(-50px);} to { opacity: 1; transform: translateY(0);} }
    .validation-message { font-size: 14px; margin-top: 8px; font-weight: 600; }
    .validation-message.error { color: #ef4444; }
    .validation-message.success { color: #10b981; }
    .validation-message.warning { color: #f59e0b; }
    .hero-section { background: linear-gradient(135deg,#1e3a8a 0%,#3b82f6 50%,#06b6d4 100%); padding: 100px 20px; text-align: center; color: #fff; position: relative; overflow: hidden; }
    .hero-section::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(255,255,255,.1) 1px, transparent 1px); background-size: 50px 50px; animation: backgroundScroll 20s linear infinite; }
    @keyframes backgroundScroll { 0%{ transform: translate(0,0);} 100%{ transform: translate(50px,50px);} }
  </style>
  <script>
    if (!window.dataSdk) {
      (function(){
        var storeKey = '__duobuddy_store__';
        function read(){ try { return JSON.parse(localStorage.getItem(storeKey)||'[]'); } catch(e){ return []; } }
        function write(d){ try { localStorage.setItem(storeKey, JSON.stringify(d)); } catch(e){} }
        var data = read(); var handler = null; var idSeq = Date.now();
        window.dataSdk = {
          init: async function(h){ handler = h; if (handler && handler.onDataChanged) handler.onDataChanged(data); return { isOk: true }; },
          create: async function(obj){ var o = { ...obj, __backendId: (++idSeq).toString() }; data.push(o); write(data); if (handler && handler.onDataChanged) handler.onDataChanged(data); return { isOk: true, value: o }; },
          update: async function(obj){ var idx = data.findIndex(function(x){ return x.__backendId === obj.__backendId; }); if (idx >= 0) { data[idx] = obj; } else { data.push(obj); } write(data); if (handler && handler.onDataChanged) handler.onDataChanged(data); return { isOk: true, value: obj }; }
        };
      })();
    }
    if (!window.elementSdk) {
      window.elementSdk = { init: async function(){ return { isOk: true }; } };
    }
  </script>
 </head>
 <body>
  <div id="homepage" class="page active">
   <nav class="gradient-bg p-4 shadow-lg">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
     <h1 class="text-white text-3xl font-bold">‚ú® SmartCard Connect</h1>
     <div class="flex gap-4"><a href="#" class="nav-link" onclick="showPage('login'); return false;">Login</a> <a href="#" class="nav-link" onclick="showPage('signup'); return false;">Sign Up</a></div>
    </div>
   </nav>
   <section class="hero-section">
    <div class="hero-content max-w-5xl mx-auto">
     <h2 class="text-6xl font-bold mb-6" style="animation: pulse 2s infinite">Your Smart Digital Business Card</h2>
     <p class="text-2xl mb-10" style="opacity:.9">Transform networking with NFC-enabled smart cards and personalized profile pages.</p>
     <div class="flex gap-6 justify-center flex-wrap"><button class="btn btn-primary text-lg px-12 py-4" onclick="showPage('signup')">üöÄ Get Started Free</button> <button class="btn btn-secondary text-lg px-12 py-4" onclick="showPage('login')">üîê Login</button></div>
    </div>
   </section>
  </div>

  <div id="orderCardModal" style="display: none; position: fixed; top:0; left:0; right:0; bottom:0; z-index:10000;">
    <div class="modal-overlay" onclick="closeOrderCardModal()">
      <div class="modal-content" onclick="event.stopPropagation()" style="position: relative; z-index: 10001;">
        <div class="p-10">
          <div class="text-center mb-8"><div class="text-6xl mb-4">üé¥</div><h3 class="text-4xl font-bold text-gray-800 mb-2">Order NFC Business Card</h3><p class="text-gray-600 text-lg">Card Slot <span id="orderCardSlot">1</span> ‚Ä¢ RM 99 per card</p></div>
          <form id="orderCardForm" onsubmit="handleOrderCard(event)">
            <div class="mb-6"><label for="orderDesign" class="block text-gray-700 mb-2 font-semibold">Card Design *</label> <select id="orderDesign" class="input-field" required onchange="updateCardDesignPreview()"> <option value="Classic Black">Classic Black - Professional matte finish</option> <option value="Premium White">Premium White - Clean modern look</option> <option value="Metallic Silver">Metallic Silver - Sleek metallic finish</option> <option value="Gold Edition">Gold Edition - Luxury gold accent</option> <option value="Custom Design">Custom Design - Contact us for details</option> </select>
              <div class="mt-4 text-center"><img id="cardDesignPreview" alt="Card Preview" style="display:none; max-width:100%; height:auto; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,.15);"></div>
            </div>
            <div class="mb-6"><label for="orderQuantity" class="block text-gray-700 mb-2 font-semibold">Quantity *</label> <select id="orderQuantity" class="input-field" required> <option value="1">1 Card - RM 99</option> <option value="2">2 Cards - RM 198</option> <option value="3">3 Cards - RM 297</option> <option value="5">5 Cards - RM 495</option> </select></div>
            <div class="mb-6"><label for="orderAddress" class="block text-gray-700 mb-2 font-semibold">Shipping Address *</label> <textarea id="orderAddress" class="input-field" rows="3" placeholder="Enter your delivery address" required></textarea></div>
            <div class="mb-6"><label for="orderNotes" class="block text-gray-700 mb-2 font-semibold">Special Notes (Optional)</label> <textarea id="orderNotes" class="input-field" rows="2" placeholder="Any special requests or instructions?"></textarea></div>
            <div class="bg-gradient-to-r from-purple-50 to-blue-50 p-6 rounded-2xl mb-6"><h4 class="font-bold text-xl text-gray-800 mb-3">üí≥ Payment Information</h4><p class="text-gray-700 mb-2"><strong>Bank:</strong> Maybank Berhad</p><p class="text-gray-700 mb-2"><strong>Account Number:</strong> 164810240562</p><p class="text-gray-700 mb-4"><strong>Account Name:</strong> DuoBuddy Enterprise</p><p class="text-sm text-gray-600 mb-4">Please transfer the amount and upload your payment proof below.</p></div>
            <div class="mb-8"><label for="paymentProofUpload" class="block text-gray-700 mb-2 font-semibold">Upload Payment Proof *</label>
              <div class="text-center"><img id="paymentProofPreview" style="display:none; max-width:300px; height:auto; border-radius:12px; margin:0 auto 16px; box-shadow:0 8px 20px rgba(0,0,0,.15);" alt="Payment Proof"><div class="mb-3"><input type="file" id="paymentProofUpload" accept="image/*" style="display:none;" onchange="handlePaymentProofUpload(event)"> <button type="button" class="btn btn-primary" onclick="document.getElementById('paymentProofUpload').click()">üì∑ Upload Payment Proof</button> <button type="button" class="btn btn-secondary ml-4" onclick="removePaymentProof()" id="removePaymentProofBtn" style="display:none;">&#128465;&#65039; Remove</button></div><p class="text-sm text-gray-500">JPG, PNG or GIF (Max 10MB) - Screenshot of bank transfer</p></div>
            </div>
            <div class="flex gap-4 justify-center"><button type="submit" class="btn btn-primary text-lg px-8">üõí Place Order</button> <button type="button" class="btn btn-secondary text-lg px-8" onclick="closeOrderCardModal()">Cancel</button></div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    const RESERVED_USERNAMES = ['admin','support','login','signup','profile','settings','help','api','www'];
    let allUsers = []; let activityLogs = []; let currentUser = null; let isAdmin = false;
    let currentSlideIndex = 0; let usernameValidationTimeout = null; let currentFilter = 'all'; let currentSearch = '';
    function normalizeUsername(u){ return (u||'').toLowerCase().replace(/[^a-z0-9]/g,''); }
    function showToast(msg, type){ var el = document.createElement('div'); el.className='toast'; el.textContent=msg; if(type==='error'){ el.style.border='2px solid #ef4444'; } document.body.appendChild(el); setTimeout(function(){ el.remove(); }, 2500); }
    async function initApp(){ const r = await window.dataSdk.init({ onDataChanged: function(d){ allUsers = d.filter(function(x){ return x.type !== 'activity_log'; }); activityLogs = d.filter(function(x){ return x.type==='activity_log'; }); } }); if(!r.isOk) return; }
    function showPage(id){ document.querySelectorAll('.page').forEach(function(p){ p.classList.remove('active'); }); document.getElementById(id).classList.add('active'); window.scrollTo(0,0); if(id==='my-cards') renderCardSlots(); }
    function renderCardSlots(){ if(!currentUser) return; const profileData = currentUser.data ? JSON.parse(currentUser.data) : {}; const cards = profileData.cards || []; const c = document.getElementById('cardSlotsContainer'); if(!c) return; c.innerHTML=''; for(let i=1;i<=10;i++){ const card = cards.find(function(x){ return x.slot===i; }); const isActive = card && card.ordered; const slot = document.createElement('div'); slot.className = 'card-slot ' + (isActive ? 'active' : ''); if(!isActive){ slot.onclick = function(e){ if(e.target.tagName !== 'BUTTON'){ orderCard(i); } }; slot.style.cursor='pointer'; } slot.innerHTML = `<div class="text-7xl mb-4">${isActive ? '&#127924;' : '‚ûï'}</div><h3 class="text-2xl font-bold mb-3 text-gray-800">Card Slot ${i}</h3><p class="text-gray-600 mb-6 text-lg">${isActive ? '‚úÖ Active Card' : 'üì¶ Available Slot'}</p>${isActive ? `<div class="bg-white p-4 rounded-xl mb-4"><p class="text-sm text-gray-600"><span class="font-semibold">Design:</span> ${card.design || 'Classic'}</p><p class="text-sm text-gray-600"><span class="font-semibold">Status:</span> Active</p></div><button class="btn btn-secondary" onclick="event.stopPropagation(); viewCard(${i})">üìã View Details</button>` : `<button class="btn btn-primary text-lg" onclick="event.stopPropagation(); orderCard(${i})">üõí Order Card - RM 99</button>`}`; c.appendChild(slot);} }
    let currentOrderSlot = null;
    function orderCard(slot){ if(!currentUser) return; currentOrderSlot = slot; document.getElementById('orderCardSlot').textContent = slot; document.getElementById('orderCardForm').reset(); document.getElementById('paymentProofPreview').style.display='none'; document.getElementById('paymentProofPreview').src=''; document.getElementById('removePaymentProofBtn').style.display='none'; const modal = document.getElementById('orderCardModal'); modal.style.display='block'; document.body.style.overflow='hidden'; updateCardDesignPreview(); }
    function closeOrderCardModal(){ document.getElementById('orderCardModal').style.display='none'; document.body.style.overflow='auto'; document.getElementById('orderCardForm').reset(); currentOrderSlot = null; }
    function updateCardDesignPreview(){ var previewImg = document.getElementById('cardDesignPreview'); previewImg.style.display='none'; }
    function handlePaymentProofUpload(e){ var f = e.target.files[0]; if(!f) return; if(f.size > 10*1024*1024){ showToast('Image size must be less than 10MB','error'); return; } if(!f.type.startsWith('image/')){ showToast('Please upload an image file','error'); return; } var reader = new FileReader(); reader.onload = function(ev){ var imgEl = document.getElementById('paymentProofPreview'); imgEl.src = ev.target.result; imgEl.style.display='block'; document.getElementById('removePaymentProofBtn').style.display='inline-block'; showToast('‚úÖ Payment proof uploaded!'); }; reader.readAsDataURL(f); }
    function removePaymentProof(){ var imgEl = document.getElementById('paymentProofPreview'); imgEl.style.display='none'; imgEl.src=''; document.getElementById('removePaymentProofBtn').style.display='none'; document.getElementById('paymentProofUpload').value=''; showToast('Payment proof removed'); }
    async function handleOrderCard(e){ e.preventDefault(); var paymentProofImg = document.getElementById('paymentProofPreview'); if(paymentProofImg.style.display==='none' || !paymentProofImg.src){ showToast('Please upload payment proof','error'); return; } var slot = currentOrderSlot; var design = document.getElementById('orderDesign').value; var quantity = parseInt(document.getElementById('orderQuantity').value); var address = document.getElementById('orderAddress').value; var notes = document.getElementById('orderNotes').value; var paymentProof = paymentProofImg.src; var totalPrice = 99 * quantity; var profileData = currentUser.data ? JSON.parse(currentUser.data) : {}; var cards = profileData.cards || []; var existingCard = cards.find(function(c){ return c.slot === slot; }); if(existingCard){ existingCard.ordered = false; existingCard.design = design; existingCard.quantity = quantity; existingCard.orderDate = new Date().toISOString(); existingCard.paymentProof = paymentProof; existingCard.address = address; existingCard.notes = notes; existingCard.totalPrice = totalPrice; existingCard.status = 'pending_approval'; } else { cards.push({ slot: slot, ordered: false, design: design, quantity: quantity, orderDate: new Date().toISOString(), paymentProof: paymentProof, address: address, notes: notes, totalPrice: totalPrice, status: 'pending_approval' }); } profileData.cards = cards; var updated = { ...currentUser, data: JSON.stringify(profileData) }; var result = await window.dataSdk.update(updated); if(result.isOk){ currentUser = updated; showToast(`üì¶ Order placed! Total: RM ${totalPrice}. Awaiting admin approval.`); closeOrderCardModal(); renderCardSlots(); } else { showToast('Failed to place order','error'); } }
    initApp();
  </script>
 </body>
</html>